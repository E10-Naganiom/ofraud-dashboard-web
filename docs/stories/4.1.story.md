# Story 4.1: Category List Page with Basic Display

## Status
Done

## Story

**As a** administrator,
**I want** to view a list of all cybercrime categories,
**so that** I can review the current taxonomy and identify categories needing updates.

## Acceptance Criteria

1. Category list page created at `/dashboard/categories` route
2. Page layout includes: page title "Gestión de Categorías", category grid/list container, "Crear Categoría" button
3. On page load, fetch all categories via `GET /categories`
4. Display categories in card grid format (3-4 columns on desktop) with:
   - Título (heading)
   - Descripción (preview, max 100 chars, ellipsis if longer)
   - Nivel de riesgo (badge with color: Alto=red, Medio=orange, Bajo=yellow, Muy Bajo=green)
   - Acciones (edit icon, delete icon)
5. Categories sorted by risk level (highest first) or alphabetically by title
6. Loading state shown while fetching
7. Empty state: "No hay categorías registradas"
8. Error state: "Error al cargar categorías"
9. Clicking category card opens detail view `/dashboard/categories/[id]`

## Tasks / Subtasks

- [x] Create page structure at `/src/app/(dashboard)/categories/page.tsx` (AC: 1)
  - [x] Create page.tsx file with Next.js App Router conventions
  - [x] Add page layout with PageHeader component showing "Gestión de Categorías"
  - [x] Add "Crear Categoría" button linking to `/dashboard/categories/new`
- [x] Implement API integration for categories (AC: 3)
  - [x] Create `src/lib/api/categories.ts` with `getCategories()` function
  - [x] Use fetch/axios to call `GET /categories` endpoint
  - [x] Define response types in `src/lib/types/category.types.ts`
- [x] Create CategoryCard component (AC: 4)
  - [x] Create `src/components/categories/CategoryCard.tsx`
  - [x] Display título, descripción (truncated to 100 chars), nivel de riesgo badge
  - [x] Add edit and delete action icons
  - [x] Make card clickable to navigate to `/dashboard/categories/[id]`
- [x] Implement category grid layout (AC: 2, 4, 5)
  - [x] Use Tailwind CSS grid (3-4 columns on desktop)
  - [x] Sort categories by risk level descending or alphabetically
  - [x] Map over categories array to render CategoryCard components
- [x] Add loading state UI (AC: 6)
  - [x] Create loading spinner component or use existing
  - [x] Show while `GET /categories` is pending
- [x] Add empty state UI (AC: 7)
  - [x] Render "No hay categorías registradas" when categories array is empty
- [x] Add error state UI (AC: 8)
  - [x] Show "Error al cargar categorías" on API error
  - [x] Include retry button or error message

## Dev Notes

### Tech Stack
[Source: architecture/tech-stack.md]
- **Framework**: Next.js 15.5.4 with App Router
- **Language**: TypeScript 5.9.3 (strict mode)
- **Styling**: Tailwind CSS 4.1.14
- **UI Components**: shadcn/ui (Card, Button, Badge)
- **State Management**: React hooks (useState, useEffect)

### Source Tree / File Locations
[Source: architecture/source-tree.md]
- **Page**: `/src/app/(dashboard)/categories/page.tsx`
- **API Client**: `/src/lib/api/categories.ts`
- **Types**: `/src/lib/types/category.types.ts`
- **Components**: `/src/components/categories/CategoryCard.tsx`
- **Common Components**: `/src/components/common/PageHeader.tsx`

### Data Models
[Source: PRD Epic 4]
**Category Model** (from backend API):
```typescript
interface Category {
  id: string;
  titulo: string;
  descripcion: string;
  nivelRiesgo: 1 | 2 | 3 | 4; // 1=Muy Bajo, 2=Bajo, 3=Medio, 4=Alto
  senales?: string;
  prevencion: string;
  acciones?: string;
  ejemplos?: string;
  imagen?: string; // URL to image
}
```

### API Specifications
[Source: PRD Epic 4, architecture/tech-stack.md]
- **Endpoint**: `GET /categories`
- **Base URL**: Configured via `NEXT_PUBLIC_API_BASE_URL` environment variable
- **Authentication**: JWT token (if required for categories endpoint)
- **Response**: `{ data: Category[] }`
- **Error Codes**: 401 (unauthorized), 500 (server error)

### Component Specifications
[Source: architecture/source-tree.md, architecture/coding-standards.md]

**CategoryCard Component**:
- Use shadcn/ui `Card` component as base
- Props: `category: Category`, `onClick?: () => void`
- Display título as heading
- Truncate descripción to 100 characters with ellipsis
- Use shadcn/ui `Badge` for risk level with color mapping:
  - Alto (4): red (bg-red-500)
  - Medio (3): orange (bg-orange-500)
  - Bajo (2): yellow (bg-yellow-500)
  - Muy Bajo (1): green (bg-green-500)
- Action icons: Edit (navigate to `/dashboard/categories/[id]/edit`), Delete (trigger delete flow)

**PageHeader Component**:
- Title: "Gestión de Categorías"
- Action button: "Crear Categoría" (primary button, navigates to `/dashboard/categories/new`)

### Coding Standards
[Source: architecture/coding-standards.md]
- Use TypeScript strict mode, no `any` types
- Functional components with hooks
- Explicit return types for functions
- Use `@/` path alias for imports
- Destructure props in component parameters
- Import order: React/Next → External libs → Internal utils/types → Components → Styles
- Use `cn()` utility for conditional Tailwind classes
- Loading/error states must be handled explicitly

### Testing
[Source: architecture/coding-standards.md]
- **Test Location**: Co-located with components (e.g., `CategoryCard.test.tsx`) or in `__tests__` directory
- **Framework**: Vitest (Post-MVP)
- **Test Coverage**: Unit tests for CategoryCard rendering, API calls, loading/error states
- **Note**: Testing is post-MVP, but code should be written with testability in mind (pure functions, separated logic)

### Project Structure Notes
- This page is part of the `(dashboard)` route group, so it will use the dashboard layout (`/src/app/(dashboard)/layout.tsx`) with sidebar navigation
- Ensure the sidebar includes a "Categorías" navigation link
- Use Next.js `useRouter` from `next/navigation` for client-side navigation
- Server components preferred for initial page load, client components for interactive elements

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-12 | 1.0 | Initial story draft created | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
claude-sonnet-4-5-20250929

### Debug Log References
None

### Completion Notes List
- Updated Category type to match PRD specifications with all required fields
- Updated mock data with comprehensive category information including risk levels
- Created CategoryCard component with risk level badges (color-coded)
- Implemented category list page with grid layout (responsive: 1-4 columns)
- Added loading, error, and empty states
- Categories sorted by risk level (highest first), then alphabetically
- All acceptance criteria met

### File List
- src/lib/types/category.types.ts (modified)
- src/lib/api/categories.ts (modified)
- src/lib/mock/data.ts (modified)
- src/lib/types/incident.types.ts (modified)
- src/components/categories/CategoryCard.tsx (created)
- src/app/(dashboard)/categories/page.tsx (created)

## QA Results
_To be filled by QA agent_
