# <!-- Powered by BMAD™ Core -->
# Story 3.5: Activate/Deactivate User

## Status
Done

## Story
**As an** administrator,
**I want** to activate or deactivate user accounts,
**so that** I can prevent login for suspended accounts without permanently deleting them.

## Acceptance Criteria
1.  The user list table on the `/dashboard/users` page includes an "Estado" column with a toggle switch for each user.
2.  The toggle visually represents the user's current `is_active` state.
3.  Clicking the toggle for a user prompts a confirmation dialog: "¿Está seguro de que desea [activar/inactivar] esta cuenta?".
4.  Upon confirmation, a **simulated** API call is made: `PATCH /admin/user/[id]/toggle-status`.
5.  During the simulated API call, the toggle is disabled and shows a loading state.
6.  On simulated success:
    -   A toast notification is displayed: "Usuario [activado/inactivado] exitosamente (Simulación)".
    -   The user's state is updated in the local component state, and the toggle reflects the new state.
7.  On simulated error (e.g., user not found):
    -   An error toast is displayed, e.g., "Usuario no encontrado (Simulación)".
    -   The toggle reverts to its original state.
8.  The deactivation logic is purely a frontend simulation. No actual backend changes are required for this story.

## Dev Notes
This section contains all relevant technical details extracted from project documentation. The developer agent should not need to read the full architecture documents.

### User Request Override
-   This story is a **frontend-only simulation**.
-   All API calls **must be simulated** using `setTimeout` to mimic network latency.
-   The primary goal is to build the UI and client-side logic for the activation/deactivation flow.

### Previous Story Insights
-   The user list page and data table are already established in previous stories. This story will add a new column and interactive element to that table.
-   The pattern of using `setTimeout` for mocked API calls and `useToast` for notifications should be continued.

### Data Models & Validation
-   The `User` type from `src/lib/types/user.types.ts` should be used. The `is_active` property is key for this story.
-   No new validation schemas are required.
-   [Source: `docs/architecture/coding-standards.md`, `docs/prd/epic-3-user-administration-profile-management.md`]
-   *Data Models Note*: No specific `data-models.md` or `database-schema.md` found. The implementation should rely on the existing TypeScript types.

### API Specifications (Mocked)
-   **Toggle Status**: The action should trigger a function that **simulates** a `PATCH` request to `/admin/user/[id]/toggle-status`.
-   **Simulate States**: The mock logic should handle:
    -   Success: Resolve the timeout and show a success toast.
    -   Not Found: If the user ID is a specific value (e.g., '0'), simulate a 404 error with a toast.
-   [Source: User Request Override, `docs/prd/epic-3-user-administration-profile-management.md`]
-   *API Spec Note*: No `rest-api-spec.md` found. The endpoint is derived from the PRD.

### Component Specifications
-   **Confirmation Dialog**: Use the `AlertDialog` component from `shadcn/ui` for the confirmation prompt.
-   **Toggle Switch**: Use the `Switch` component from `shadcn/ui` to represent the user's active status.
-   **Data Table**: The `DataTable` component used in the user list will need to be modified to include a new column for the status toggle.
-   **Notifications**: Use the `useToast` hook from `shadcn/ui` for all user feedback.
-   [Source: `docs/architecture/tech-stack.md`, `docs/architecture/source-tree.md`]

### File Locations
-   **User List Page**: `src/app/(dashboard)/users/page.tsx` (and its associated data table component, likely `src/components/users/UserList.tsx` or similar).
-   **New Component**: A new component, `src/components/users/UserStatusToggle.tsx`, could be created to encapsulate the toggle, dialog, and mock API call logic for reusability.
-   [Source: `docs/architecture/source-tree.md`]

## Tasks / Subtasks
-   **Task 1: Create `UserStatusToggle` Component** (AC: 1, 2, 3, 5)
    -   Create a new component `src/components/users/UserStatusToggle.tsx`.
    -   It should accept the `user` object as a prop.
    -   It will render a `Switch` component from `shadcn/ui`, bound to the `user.is_active` property.
    -   Clicking the switch will trigger an `AlertDialog` from `shadcn/ui` to confirm the action.

-   **Task 2: Implement Mocked API Logic** (AC: 4, 6, 7)
    -   Inside the `UserStatusToggle` component, create a handler for the confirmation action.
    -   This handler will manage a `loading` state.
    -   Implement the simulated `PATCH` request using `setTimeout` (e.g., 500ms).
    -   On success, call a prop function (e.g., `onStatusChange`) to update the parent component's state and show a success toast.
    -   Handle mock errors and show an error toast.

-   **Task 3: Integrate into User List** (AC: 1)
    -   Modify the user data table component (`UserList.tsx` or `DataTable`).
    -   Add a new column for "Estado".
    -   In the cell renderer for this column, render the new `UserStatusToggle` component, passing the user data and the state update handler.
    -   The parent page (`users/page.tsx`) will need to manage the list of users in its state so that it can be updated when the status changes.

## Testing
-   Manual testing is required. Verify that the toggle reflects the correct state, the confirmation dialog appears, the loading state works, and the mocked submission flow (success and error) behaves as expected.

## Dev Agent Record

### File List
- src/components/ui/alert-dialog.tsx (created)
- src/components/ui/switch.tsx (created)
- src/components/ui/checkbox.tsx (created)
- src/components/users/UserStatusToggle.tsx (created)
- src/components/users/UserList.tsx (modified)
- src/app/(dashboard)/users/page.tsx (modified)
- src/hooks/useDebounce.ts (modified - fixed export)
- src/lib/api/users.ts (modified - fixed mock data)
- src/lib/mock/users.ts (modified - fixed field name)

### Completion Notes
- Implemented UserStatusToggle component with AlertDialog confirmation
- Integrated toggle switch into user list table
- Added mocked API logic with simulated success/error responses
- Fixed TypeScript export issues with useDebounce hook
- Build passes successfully

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-10-12 | 1.0 | Initial draft of story 3.5 | Bob (Scrum Master) |
| 2025-10-12 | 1.1 | Implementation completed | James (Dev Agent) |
