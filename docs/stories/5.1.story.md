# Story 5.1: Dashboard Home Page with Metrics

## Status
Ready for Review

## Story

**As an** administrator,
**I want** to see a dashboard home page with key metrics and recent activity,
**so that** I can quickly understand the platform's current state when I log in.

## Acceptance Criteria

1. Dashboard home page created at `/dashboard` route (default landing after login)
2. Page layout includes: page title "Panel de Administración", metrics widgets section, recent activity section
3. Metrics widgets display:
   - Total de incidentes (fetch from `GET /admin/incidents/list`, count all)
   - Incidentes pendientes (count where `id_estatus=1`)
   - Incidentes aprobados (count where `id_estatus=2`)
   - Incidentes rechazados (count where `id_estatus=3`)
   - Total de usuarios (fetch from `GET /admin/user/list`, count all)
   - Total de categorías (fetch from `GET /categories`, count all)
4. Each metric displayed in card with large number, label, and icon
5. Recent activity section displays:
   - Last 5-10 incidents created (sorted by `fecha_creacion` desc)
   - Show: Título (truncated), Categoría, Fecha, Estado badge
   - Clickable to navigate to incident detail
6. "Ver todos los incidentes" link navigates to `/dashboard/incidents`
7. Loading state shown while fetching metrics
8. Error handling: if metrics fail to load, show partial data with error message for failed widgets

## Tasks / Subtasks

- [x] Create dashboard home page component (AC: 1, 2)
  - [x] Create file `/src/app/(dashboard)/dashboard/page.tsx`
  - [x] Implement page layout with title "Panel de Administración"
  - [x] Create sections for metrics widgets and recent activity
- [x] Implement metrics widgets section (AC: 3, 4, 7, 8)
  - [x] Create `MetricCard` component in `/src/components/dashboard/MetricCard.tsx`
  - [x] Component displays large number, label, and icon
  - [x] Implement loading skeleton state for metrics
  - [x] Add 6 metric cards: Total incidentes, Pendientes, Aprobados, Rechazados, Usuarios, Categorías
  - [x] Use icons from Lucide React (consistent with navigation)
- [x] Create custom hook for dashboard metrics (AC: 3, 7, 8)
  - [x] Create `/src/hooks/useDashboardMetrics.ts`
  - [x] **IMPORTANT: Use mock data for all metrics - do not call real backend APIs**
  - [x] Mock data structure:
    - Total incidents: 45
    - Pending incidents: 12
    - Approved incidents: 28
    - Rejected incidents: 5
    - Total users: 8
    - Total categories: 15
  - [x] Return loading state, error state, and metrics data
  - [x] Handle partial loading (some metrics fail, others succeed)
- [x] Implement recent activity section (AC: 5, 6)
  - [x] Create `RecentIncidentsList` component in `/src/components/dashboard/RecentIncidentsList.tsx`
  - [x] **IMPORTANT: Use mock data for recent incidents (5-10 items)**
  - [x] Mock incident data should include: id, título, categoría, fecha_creacion, id_estatus
  - [x] Display incident cards/rows with truncated title (max 60 chars), category, date, status badge
  - [x] Make each incident clickable to navigate to `/dashboard/incidents/[id]`
  - [x] Add "Ver todos los incidentes" link at bottom → `/dashboard/incidents`
- [x] Style dashboard with shadcn/ui components (AC: 4)
  - [x] Use Card component for metric widgets
  - [x] Use Badge component for status indicators
  - [x] Grid layout for metrics (3 columns on desktop, responsive)
  - [x] Proper spacing and typography per coding standards
- [x] Implement error handling and empty states (AC: 8)
  - [x] Display error toast if metrics completely fail to load
  - [x] Show partial data with inline error message for individual failed widgets
  - [x] Empty state message if no recent incidents exist

## Dev Notes

### User Instructions - CRITICAL
**MOCK DATA ONLY**: The user has explicitly requested that this story use mock data for frontend testing. DO NOT make real API calls to the backend. DO NOT add restrictions based on backend functionality. The backend will not be connected until the end of the project. Focus on creating a fully testable frontend flow with realistic mock data.

### Tech Stack
[Source: architecture/tech-stack.md]
- **Framework**: Next.js 15.5.4 with App Router
- **Language**: TypeScript 5.9.3 (strict mode)
- **Styling**: Tailwind CSS 4.1.14
- **UI Components**: shadcn/ui (Card, Badge, Skeleton)
- **Icons**: Lucide React (consistent with navigation)
- **State Management**: React hooks (useState, useEffect for custom hooks)

### Source Tree / File Locations
[Source: architecture/source-tree.md]
- **Page**: `/src/app/(dashboard)/dashboard/page.tsx` (create new)
- **Components**:
  - `/src/components/dashboard/MetricCard.tsx` (create new)
  - `/src/components/dashboard/RecentIncidentsList.tsx` (create new)
- **Hooks**: `/src/hooks/useDashboardMetrics.ts` (create new)
- **Mock Data**: Create `/src/lib/mock/dashboardData.ts` (create new)

### Component Specifications

**MetricCard Component**:
```typescript
interface MetricCardProps {
  label: string;
  value: number | string;
  icon: React.ReactNode;
  loading?: boolean;
  error?: boolean;
  className?: string;
}
```
- Use shadcn/ui Card component as base
- Large number display (text-3xl or text-4xl font)
- Label below number (text-sm text-muted-foreground)
- Icon in top-right or left side
- Loading state: Skeleton component
- Error state: Red border with error icon

**Recent Incidents Display**:
- Show 5-10 most recent incidents
- Truncate title to ~60 characters with ellipsis
- Display category name (not just ID)
- Format date (use standard format: "DD/MM/YYYY" or relative time)
- Status badge colors:
  - Pendiente: Yellow/warning
  - Aprobado: Green/success
  - Rechazado: Red/destructive

### Mock Data Structure
[Source: User requirements - frontend testing with mock data]

Create `/src/lib/mock/dashboardData.ts`:
```typescript
export const mockDashboardMetrics = {
  totalIncidents: 45,
  pendingIncidents: 12,
  approvedIncidents: 28,
  rejectedIncidents: 5,
  totalUsers: 8,
  totalCategories: 15,
};

export const mockRecentIncidents = [
  {
    id: "1",
    titulo: "Reporte de phishing en correo corporativo",
    categoria: "Phishing",
    fecha_creacion: "2025-10-12T10:30:00Z",
    id_estatus: 1, // Pendiente
  },
  // ... 4-9 more realistic incidents
];
```

### API Specifications (FOR REFERENCE ONLY - NOT USED IN THIS STORY)
[Source: PRD Epic 5]
The following endpoints are documented for future integration but MUST NOT be called in this story:
- `GET /admin/incidents/list` - Fetch all incidents
- `GET /admin/user/list` - Fetch all users
- `GET /categories` - Fetch all categories

### Layout Integration
[Source: architecture/source-tree.md]
- Dashboard page lives in `/src/app/(dashboard)/dashboard/page.tsx`
- Uses dashboard layout from `/src/app/(dashboard)/layout.tsx` (sidebar already exists)
- This should be the default landing page after login (root `/dashboard` route)
- Navigation component already created in Story 5.2 (reference if exists, otherwise create basic version)

### Coding Standards
[Source: architecture/coding-standards.md]
- TypeScript strict mode - all functions have explicit return types
- Functional components only
- Props destructuring in component parameters
- Custom hooks for data fetching logic (even with mock data)
- Proper error handling with try-catch
- Loading states using shadcn/ui Skeleton components
- Use `cn()` utility for conditional class names
- Icons from Lucide React (Home, TrendingUp, Users, Tag, AlertCircle, CheckCircle, XCircle)

### Styling Guidelines
[Source: architecture/coding-standards.md]
- Metrics grid: 3 columns on desktop (`grid-cols-1 md:grid-cols-2 lg:grid-cols-3`)
- Proper spacing: `gap-4` or `gap-6` between cards
- Typography: Page title `text-2xl font-bold`, metric values `text-3xl font-bold`, labels `text-sm text-muted-foreground`
- Color palette: Use Tailwind default colors (blue, green, yellow, red)
- Responsive: Stack metrics vertically on mobile

### Testing
[Source: architecture/coding-standards.md, PRD requirements]
**Test Location**: `page.test.tsx` (Post-MVP with Vitest)
**Manual Testing for MVP**:
- Dashboard loads with mock metrics displayed correctly
- All 6 metric cards render with proper labels and icons
- Recent incidents list displays 5-10 items
- Incident titles truncate properly
- Status badges show correct colors
- Loading skeletons appear briefly (test with artificial delay)
- "Ver todos los incidentes" link navigates correctly
- Clicking incident navigates to detail view
- Responsive layout works on mobile/tablet/desktop

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-12 | 1.0 | Initial story draft created with mock data requirements | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
claude-sonnet-4-5-20250929

### Debug Log References
None

### Completion Notes List
- Created dashboard home page with metrics and recent activity sections
- Implemented MetricCard component with loading skeleton and error states
- Created RecentIncidentsList with 8 mock incidents
- All mock data properly structured with realistic Spanish content
- Date formatting shows relative time (hours/days ago)
- Title truncation working at 60 characters
- Status badges with proper color variants
- Grid layout responsive (1/2/3 columns)

### File List
- Created: `/src/app/(dashboard)/dashboard/page.tsx`
- Created: `/src/components/dashboard/MetricCard.tsx`
- Created: `/src/components/dashboard/RecentIncidentsList.tsx`
- Created: `/src/hooks/useDashboardMetrics.ts`
- Created: `/src/lib/mock/dashboardData.ts`
- Added: `/src/components/ui/skeleton.tsx` (shadcn/ui)

## QA Results
_To be filled by QA agent_
