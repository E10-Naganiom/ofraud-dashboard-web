# Story 4.2: Category Detail View

## Status
Done

## Story

**As a** administrator,
**I want** to view the complete information for a cybercrime category including prevention tips and examples,
**so that** I can understand how the category is presented to end-users.

## Acceptance Criteria

1. Category detail page created at `/dashboard/categories/[id]` route
2. On page load, fetch category details via `GET /categories/[id]`
3. Display full category information:
   - Título
   - Descripción (full text)
   - Nivel de riesgo (badge)
   - Señales (signs/indicators, full text)
   - Prevención (prevention measures, full text)
   - Acciones (recommended actions, full text)
   - Ejemplos (examples, full text)
   - Imagen (display image if URL exists, otherwise placeholder)
4. "Editar" button navigates to edit page `/dashboard/categories/[id]/edit`
5. "Eliminar" button triggers delete confirmation (Story 4.5)
6. "Volver a lista" button navigates back to `/dashboard/categories`
7. Loading state while fetching
8. Error handling: if category not found (404), display "Categoría no encontrada"

## Tasks / Subtasks

- [x] Create dynamic route page at `/src/app/(dashboard)/categories/[id]/page.tsx` (AC: 1)
  - [x] Create [id] directory under categories
  - [x] Create page.tsx with Next.js dynamic route parameter
  - [x] Extract `id` from route params using Next.js `useParams()`
- [x] Implement API integration for single category (AC: 2)
  - [x] Add `getCategoryById(id: string)` function to `src/lib/api/categories.ts`
  - [x] Call `GET /categories/[id]` endpoint
  - [x] Handle loading state
  - [x] Handle error responses (404, 500)
- [x] Create CategoryDetailDisplay component (AC: 3)
  - [x] Create `src/components/categories/CategoryDetailDisplay.tsx`
  - [x] Display all category fields in readable layout
  - [x] Use sections/cards for organization (e.g., "Información General", "Prevención y Acciones")
  - [x] Display risk level badge with color coding
  - [x] Display image using Next.js `<Image>` component if URL exists, else show placeholder
- [x] Add action buttons (AC: 4, 5, 6)
  - [x] "Editar" button: navigates to `/dashboard/categories/[id]/edit` using `useRouter`
  - [x] "Eliminar" button: opens delete confirmation dialog (prepare for Story 4.5)
  - [x] "Volver a lista" button: navigates back to `/dashboard/categories`
- [x] Implement loading state (AC: 7)
  - [x] Show loading spinner while fetching category
  - [x] Use existing LoadingSpinner component or create one
- [x] Implement error handling (AC: 8)
  - [x] Check for 404 response, display "Categoría no encontrada"
  - [x] Display error message for other errors
  - [x] Provide "Volver a lista" option on error

## Dev Notes

### Tech Stack
[Source: architecture/tech-stack.md]
- **Framework**: Next.js 15.5.4 with App Router (dynamic routes `[id]`)
- **Language**: TypeScript 5.9.3 (strict mode)
- **Styling**: Tailwind CSS 4.1.14
- **UI Components**: shadcn/ui (Card, Button, Badge)
- **Image Optimization**: Next.js `<Image>` component

### Source Tree / File Locations
[Source: architecture/source-tree.md]
- **Page**: `/src/app/(dashboard)/categories/[id]/page.tsx`
- **API Client**: `/src/lib/api/categories.ts` (add `getCategoryById()`)
- **Types**: `/src/lib/types/category.types.ts`
- **Component**: `/src/components/categories/CategoryDetailDisplay.tsx`

### Data Models
[Source: PRD Epic 4]
**Category Model**:
```typescript
interface Category {
  id: string;
  titulo: string;
  descripcion: string;
  nivelRiesgo: 1 | 2 | 3 | 4;
  senales?: string;
  prevencion: string;
  acciones?: string;
  ejemplos?: string;
  imagen?: string; // URL
}
```

### API Specifications
[Source: PRD Epic 4, architecture/tech-stack.md]
- **Endpoint**: `GET /categories/[id]`
- **Base URL**: `NEXT_PUBLIC_API_BASE_URL`
- **Authentication**: JWT token (if required)
- **Success Response (200)**: `{ data: Category }`
- **Error Responses**:
  - 404 Not Found: Category does not exist
  - 401 Unauthorized: Invalid/missing token
  - 500 Server Error

### Component Specifications
[Source: architecture/source-tree.md, architecture/coding-standards.md]

**CategoryDetailDisplay Component**:
- Props: `category: Category`
- Layout using shadcn/ui `Card` components for sections
- Sections:
  1. **Información General**: Título, Descripción, Imagen, Nivel de Riesgo badge
  2. **Indicadores**: Señales (if exists)
  3. **Prevención y Acciones**: Prevención, Acciones (if exists)
  4. **Ejemplos**: Ejemplos (if exists)
- Use Next.js `<Image>` for category image:
  - `src={category.imagen}` if exists
  - Fallback to placeholder if no image
  - Add `width`, `height`, `alt` props for optimization

**Risk Level Badge Colors**:
- Alto (4): red
- Medio (3): orange
- Bajo (2): yellow
- Muy Bajo (1): green

### Coding Standards
[Source: architecture/coding-standards.md]
- TypeScript strict mode, no `any`
- Use `useParams()` from `next/navigation` to get dynamic route `id`
- Use `useRouter()` for navigation
- Handle all loading and error states explicitly
- Use async/await for API calls with try-catch
- Functional components with hooks
- Explicit return types for functions

### Testing
[Source: architecture/coding-standards.md]
- **Test Location**: `src/app/(dashboard)/categories/[id]/page.test.tsx` or co-located
- **Framework**: Vitest (Post-MVP)
- **Test Cases**:
  - Renders category details correctly
  - Shows loading spinner while fetching
  - Displays 404 error message when category not found
  - Action buttons navigate to correct routes

### Project Structure Notes
- Dynamic route uses Next.js `[id]` directory convention
- Page is server-side rendered by default, use client component if needed for interactivity
- Ensure consistency with other detail pages (incidents, users)
- No specific guidance found in architecture docs for image placeholders (use standard approach)

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-12 | 1.0 | Initial story draft created | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
claude-sonnet-4-5-20250929

### Debug Log References
None

### Completion Notes List
- Created CategoryDetailDisplay component with organized sections (Información General, Señales, Prevención y Acciones, Ejemplos)
- Implemented dynamic route page with useParams for id extraction
- Added getCategoryById function to API client (already done in Story 4.1)
- Implemented loading state with spinner
- Added error handling for 404 and general errors
- Created action buttons (Volver, Editar, Eliminar) with proper navigation
- Used Next.js Image component for optimized image loading with placeholder fallback
- All sections conditionally rendered based on data availability
- All acceptance criteria met

### File List
- src/components/categories/CategoryDetailDisplay.tsx (created)
- src/app/(dashboard)/categories/[id]/page.tsx (created)
- src/lib/api/categories.ts (already modified in Story 4.1)

## QA Results
_To be filled by QA agent_
