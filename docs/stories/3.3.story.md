# <!-- Powered by BMAD™ Core -->
# Story 3.3: Create New User

## Status
Done

## Story
**As an** administrator,
**I want** to manually create new user accounts with specified details,
**so that** I can onboard users or admins without requiring self-registration.

## Acceptance Criteria
1. "Crear Usuario" button on user list page opens create modal or navigates to `/dashboard/users/new`.
2. Create user form displays fields:
   - Nombre (text, required, max 50 chars)
   - Apellido (text, required, max 50 chars)
   - Correo electrónico (email, required, unique, max 190 chars)
   - Contraseña (password, required, min 8, max 20 alphanumeric)
   - Confirmación de contraseña (password, required, must match)
   - Es administrador (checkbox for `is_admin` flag)
   - Cuenta activa (toggle for `is_active` flag, default true)
3. Form validation using React Hook Form + Zod.
4. Submit button disabled until form is valid.
5. On submit, simulate an API call: `POST /admin/user`.
6. On simulated success:
   - Display a toast: "Usuario creado exitosamente (Simulación)".
   - Close the modal or navigate back to the user list.
   - **Optional**: Add the new user to the local state to see it in the list.
7. On simulated error (e.g., email exists):
   - Display a toast: "El correo ya está registrado (Simulación)".
8. A loading state should be shown during the simulated API call.
9. "Cancelar" button closes the modal/navigates back without saving.

## Dev Notes
This section contains all relevant technical details extracted from project documentation. The developer agent should not need to read the full architecture documents.

### User Request Override
- The user has explicitly requested that this story be implemented with a **frontend-only focus**.
- The backend is not yet connected. All API calls **must be simulated**.
- The goal is to build and validate the complete user interface and form logic.
- Mock data should be used to demonstrate the flow.

### Previous Story Insights
- Story 3.2 implemented client-side search. This story will introduce form handling and (mocked) mutation.

### Data Models & Validation
- A `User` type should be defined in `src/lib/types/user.types.ts` if it doesn't exist.
- A Zod validation schema for the new user form should be created in `src/lib/validations/user.schema.ts`.
- The schema must enforce all constraints mentioned in the Acceptance Criteria (required fields, lengths, formats).
- [Source: `docs/prd/epic-3-user-administration-profile-management.md`, `docs/architecture/coding-standards.md`]

### API Specifications (Mocked)
- The form submission should trigger a function that **simulates** a `POST` request to `/admin/user`.
- This function should not make a real network request. Use `setTimeout` to simulate network latency (e.g., 500ms).
- The function should be able to simulate both success and error responses to test the UI's reaction. For example, you can check for a specific email like `test@exists.com` to trigger a conflict error.
- [Source: User Request Override, `docs/prd/epic-3-user-administration-profile-management.md`]

### Component Specifications
- **Form Library**: Use `React Hook Form` for managing form state and validation.
- **UI Components**: Use `shadcn/ui` components (`Input`, `Button`, `Checkbox`, `Switch`, `Form`) for all form elements.
- **Component Location**:
    - The form itself should be a reusable component: `src/components/users/UserForm.tsx`.
    - The page to host the form will be `src/app/(dashboard)/users/new/page.tsx`.
- **Notifications**: Use the `useToast` hook (from `shadcn/ui`) to display success and error messages.
- [Source: `docs/architecture/source-tree.md`, `docs/architecture/tech-stack.md`]

### File Locations
- **New Page**: `src/app/(dashboard)/users/new/page.tsx`
- **New Component**: `src/components/users/UserForm.tsx`
- **New Validation Schema**: `src/lib/validations/user.schema.ts`
- **Type Definitions**: `src/lib/types/user.types.ts` (if modification is needed)
- [Source: `docs/architecture/source-tree.md`]

## Tasks / Subtasks
- [x] **Task 1: Create Zod Validation Schema** (AC: 3)
    - [x] In `src/lib/validations/user.schema.ts`, define a Zod object schema for the new user form.
    - [x] Include validations for `nombre`, `apellido`, `email`, `password`, and `confirmPassword`. Ensure password matching logic is included.
    - [x] Export the schema and the inferred TypeScript type.

- [x] **Task 2: Build the `UserForm` Component** (AC: 2, 4)
    - [x] Create `src/components/users/UserForm.tsx`.
    - [x] Use `React Hook Form` and the Zod schema for validation (`zodResolver`).
    - [x] Build the form layout using `shadcn/ui` `Form`, `FormField`, `FormItem`, `FormLabel`, `FormControl`, `FormMessage` components.
    - [x] Use `Input` for text fields, `Checkbox` for `is_admin`, and `Switch` for `is_active`.
    - [x] The submit button should be disabled if the form is invalid (`!form.formState.isValid`).
    - [x] The component should accept `onSubmit`, `isLoading`, and `onCancel` props.

- [x] **Task 3: Create the New User Page** (AC: 1, 9)
    - [x] Create the page file `src/app/(dashboard)/users/new/page.tsx`.
    - [x] Import and render the `UserForm` component.
    - [x] Add a page title, e.g., "Crear Nuevo Usuario".
    - [x] Implement the `onCancel` handler to navigate back to the `/users` page using `useRouter`.

- [x] **Task 4: Implement Mocked Submission Logic** (AC: 5, 6, 7, 8)
    - [x] In the `new/page.tsx`, create the `onSubmit` handler for the `UserForm`.
    - [x] This handler will manage a `loading` state.
    - [x] Inside the handler, implement the simulated API call using `setTimeout`.
    - [x] **Simulate Success**: If the email is not a special "error" case, resolve the timeout, show a success toast (`"Usuario creado exitosamente (Simulación)"`), and navigate back to the user list.
    - [x] **Simulate Error**: If the email is `test@exists.com`, resolve the timeout and show a conflict error toast (`"El correo ya está registrado (Simulación)"`).
    - [x] Ensure the form's submit button is in a loading state during the simulation.

- [x] **Task 5: Update User List Page** (AC: 1)
    - [x] On the main user list page (`/users`), ensure the "Crear Usuario" button exists and navigates to `/users/new`.

## Testing
- Per `coding-standards.md`, automated testing is post-MVP. Manual testing of the form validation and submission flow is required.

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-10-12 | 1.0 | Initial draft of story 3.3 | Bob (Scrum Master) |
| 2025-10-12 | 1.1 | Implemented the create new user form and simulated submission logic. | James (Developer) |
