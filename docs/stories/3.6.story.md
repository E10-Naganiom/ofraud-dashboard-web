# <!-- Powered by BMAD™ Core -->
# Story 3.6: Admin Profile View and Edit

## Status
Done

## Story
**As an** administrator,
**I want** to view and edit my own profile information,
**so that** I can keep my account details up-to-date.

## Acceptance Criteria
1.  A new page is created at the `/dashboard/profile` route.
2.  A navigation link, "Mi Perfil", is added to the main dashboard layout (e.g., in the sidebar or a user dropdown menu).
3.  On page load, the component **simulates** fetching the current admin's data. For this story, use a hardcoded mock user object.
4.  The page displays the admin's information in a read-only view: Nombre, Apellido, Correo electrónico, Rol, and Estado.
5.  An "Editar Perfil" button is present. Clicking it switches the component to an edit mode.
6.  In edit mode, a form is displayed allowing the update of: Nombre, Apellido, and Correo electrónico.
7.  The form reuses the `UserForm` component, configured for this profile-editing scenario (e.g., hiding role and status fields).
8.  Password change functionality is **out of scope** for this story.
9.  On form submission, a **simulated** API call is made: `PUT /users/profile`.
10. On simulated success:
    -   A toast notification is displayed: "Perfil actualizado exitosamente (Simulación)".
    -   The component returns to the read-only view, showing the updated mock data.
11. On simulated error (e.g., validation failure):
    -   An appropriate error toast is displayed.
12. A "Cancelar" button in edit mode discards changes and returns to the read-only view.

## Dev Notes
This section contains all relevant technical details extracted from project documentation. The developer agent should not need to read the full architecture documents.

### User Request Override
-   This story is a **frontend-only simulation**.
-   All API calls **must be simulated** using `setTimeout`.
-   The current user's data should be mocked. There is no real auth context to pull from yet.

### Previous Story Insights
-   The `UserForm` component and its associated Zod schema (`editUserSchema`) from stories 3.3 and 3.4 should be reused and adapted for this purpose.
-   The pattern of switching between a view and an edit state within a single page can be implemented with a simple state variable (`const [isEditing, setIsEditing] = useState(false)`).

### Data Models & Validation
-   The `User` type from `src/lib/types/user.types.ts` should be used for the mock data.
-   The `editUserSchema` from `src/lib/validations/user.schema.ts` should be sufficient for validating the form fields.
-   [Source: `docs/architecture/coding-standards.md`, `docs/prd/epic-3-user-administration-profile-management.md`]

### API Specifications (Mocked)
-   **Fetch Profile**: On page load, use a hardcoded mock `User` object. No `useEffect` fetch simulation is required unless you want to show a loading spinner.
-   **Update Profile**: The form submission should trigger a function that **simulates** a `PUT` request to `/users/profile`. This function should use `setTimeout` (e.g., 500ms).
-   [Source: User Request Override, `docs/prd/epic-3-user-administration-profile-management.md`]

### Component Specifications
-   **Form Component**: Reuse `src/components/users/UserForm.tsx`. You may need to add logic to conditionally hide fields like `is_admin` and `is_active` that are not editable on the profile page.
-   **UI Components**: Use `shadcn/ui` components like `Card` to display the profile information, `Button` for actions, and `Input` within the form.
-   **State Management**: A local `useState` hook within the profile page component is sufficient to manage the mock user data and the `isEditing` state.
-   **Notifications**: Use the `useToast` hook from `shadcn/ui`.
-   [Source: `docs/architecture/tech-stack.md`, `docs/architecture/source-tree.md`]

### File Locations
-   **Profile Page**: `src/app/(dashboard)/profile/page.tsx`.
-   **Layout Modification**: The dashboard layout (likely `src/components/layout/Sidebar.tsx` or a similar file) will need to be modified to add the "Mi Perfil" link.
-   **Form Component**: `src/components/users/UserForm.tsx` (may need modification).
-   [Source: `docs/architecture/source-tree.md`]

## Tasks / Subtasks
-   **Task 1: Create Profile Page Structure** (AC: 1, 4)
    -   Create the page file `src/app/(dashboard)/profile/page.tsx`.
    -   Implement state to hold the mock user data and the `isEditing` flag.
    -   Create the read-only view using `Card` components to display the user's name, email, role, etc.
    -   Add the "Editar Perfil" button.

-   **Task 2: Implement Edit Mode** (AC: 5, 6, 7)
    -   Conditionally render the `UserForm` component when `isEditing` is true.
    -   Pass the mock user data to the `UserForm` as `initialData`.
    -   Ensure the `UserForm` is configured or modified to only show the fields relevant to profile editing (Name, Surname, Email).

-   **Task 3: Implement Mocked Update Logic** (AC: 9, 10, 11, 12)
    -   Create the `onSubmit` handler for the `UserForm`.
    -   This handler will manage a `loading` state and use `setTimeout` to simulate the API call.
    -   On success, update the local user state, set `isEditing` to `false`, and show a success toast.
    -   On error, show an error toast.
    -   Implement the "Cancelar" button to reset state and exit edit mode.

-   **Task 4: Add Navigation Link** (AC: 2)
    -   Locate the primary dashboard navigation component (e.g., `Sidebar.tsx`).
    -   Add a new link to `/dashboard/profile` with the text "Mi Perfil".

## Testing
-   Manual testing is required. Verify the profile data displays correctly, switching to edit mode works, the form populates and saves correctly (in the mock state), and toasts are displayed as expected.

## Dev Agent Record

### File List
- src/app/(dashboard)/profile/page.tsx (created)
- src/app/(dashboard)/layout.tsx (modified - added navigation link)
- src/components/users/UserForm.tsx (modified - fixed TypeScript types)
- src/app/(dashboard)/users/new/page.tsx (modified - fixed types)

### Completion Notes
- Created profile page with read-only view displaying user information
- Implemented edit mode using existing UserForm component
- Added mocked update logic with simulated API call
- Added "Mi Perfil" navigation link in dashboard layout header
- Build passes successfully

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-10-12 | 1.0 | Initial draft of story 3.6 | Bob (Scrum Master) |
| 2025-10-12 | 1.1 | Implementation completed | James (Dev Agent) |
